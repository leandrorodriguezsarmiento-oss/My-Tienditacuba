<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIPCELLUNLOCK | Premium Store</title>
    <style>
        :root {
            --gold: #d4af37;
            --dark: #121212;
            --bg: #f5f5f7;
            --white: #ffffff;
            --whatsapp: #25d366;
        }

        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            margin: 0; background: var(--bg); color: #333; 
            padding-bottom: 150px;
        }

        header { 
            background: #000; color: white; text-align: center; 
            padding: 50px 20px; border-bottom: 4px solid var(--gold);
        }

        .lock-icon { font-size: 45px; color: var(--gold); display: block; margin-bottom: 10px; }
        header h1 { font-size: 2.2rem; margin: 0; letter-spacing: 2px; color: var(--gold); font-weight: 800; }
        header p { color: #86868b; margin-top: 5px; }

        .tabs { 
            display: flex; justify-content: center; background: white; 
            padding: 10px 0; position: sticky; top: 0; z-index: 1000; 
            border-bottom: 1px solid #ddd;
        }

        .tab-btn { 
            border: none; background: none; padding: 12px 25px; 
            font-weight: bold; cursor: pointer; border-radius: 25px; transition: 0.3s;
        }

        .tab-btn.active { background: var(--gold); color: black; }

        .container { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); 
            gap: 25px; padding: 30px 20px; max-width: 1100px; margin: auto; 
        }

        .card { 
            background: white; border-radius: 22px; padding: 25px; 
            text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
            border: 1px solid #eee; transition: 0.3s;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--gold); }
        .card img { width: 100%; height: 180px; object-fit: contain; margin-bottom: 15px; border-radius: 10px; }

        .price { font-size: 1.6rem; font-weight: 800; color: var(--dark); display: block; margin: 15px 0; }
        
        .btn-add { 
            background: var(--dark); color: var(--gold); border: 1px solid var(--gold); 
            width: 100%; padding: 14px; border-radius: 12px; font-weight: bold; cursor: pointer; 
        }

        .cart-float { 
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); 
            background: white; width: 90%; max-width: 420px; border-radius: 28px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.2); padding: 25px; display: none; z-index: 2000; 
            border: 2px solid var(--gold);
        }

        input { width: 90%; padding: 12px; margin-top: 15px; border-radius: 10px; border: 1px solid #ddd; outline: none; }
        
        .loading { text-align: center; padding: 100px 20px; font-weight: bold; color: var(--gold); font-size: 1.2rem; }

        footer { text-align: center; padding: 40px 20px; background: #000; color: #86868b; margin-top: 50px; }
        footer a { color: var(--gold); text-decoration: none; }
    </style>
</head>
<body>

<header>
    <span class="lock-icon">üîê</span>
    <h1>VIPCELLUNLOCK</h1>
    <p>Premium Technology & Solutions</p>
</header>

<div class="tabs">
    <button class="tab-btn active" id="btn-prod" onclick="switchTab('prod')">Productos</button>
    <button class="tab-btn" id="btn-serv" onclick="switchTab('serv')">Servicios / Unlock</button>
</div>

<div id="loader" class="loading">Sincronizando con la nube de VIPCELL...</div>
<div class="container" id="grid"></div>

<div class="cart-float" id="cart">
    <div style="font-weight: 800; text-align: center; margin-bottom: 15px; font-size: 1.1rem;">üìã TU PEDIDO</div>
    <div id="cart-items" style="font-size: 14px; max-height: 150px; overflow-y: auto;"></div>
    <div style="display: flex; justify-content: space-between; font-weight: 800; margin-top: 15px; font-size: 1.3rem; border-top: 1px solid #eee; padding-top: 10px;">
        <span>Total:</span><span id="cart-total">$0.00</span>
    </div>
    <input type="text" id="c-name" placeholder="Tu Nombre o Usuario">
    <button onclick="send()" style="background:var(--whatsapp); color:white; border:none; width:100%; padding:16px; border-radius:15px; font-weight:bold; cursor:pointer; margin-top:15px; font-size: 16px;">üöÄ ENVIAR SOLICITUD</button>
</div>

<footer>
    <p>¬© 2026 VIPCELLUNLOCK</p>
    <a href="https://leandrorodriguezsarmiento-oss.github.io/My-Tienditacuba/">Web Oficial de Soporte</a>
</footer>

<script>
    // Enlace de Google Sheets corregido
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-ncIuqeaDv5Q1HB6DFE9rCCnIuoFzYciClZSohoZxoVtFJdx-Z7xIR1V9JdVAx0PAJw_-Hd2IlG3Z/pub?output=csv';
    const tel = "5356530329";
    
    let db = { prod: [], serv: [] };
    let cart = {};
    let currentTab = 'prod';

    async function loadData() {
        try {
            const response = await fetch(SHEET_URL);
            const data = await response.text();
            
            // Procesar el CSV de Google
            const rows = data.split('\n').slice(1);
            db.prod = []; db.serv = [];
            
            rows.forEach(row => {
                // Manejo de comas dentro de celdas
                const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                
                if(cols && cols.length >= 4) {
                    const item = { 
                        n: cols[0].replace(/"/g, ''), 
                        p: parseFloat(cols[1]), 
                        i: cols[2].replace(/"/g, ''), 
                        type: cols[3].trim().toLowerCase(),
                        s: parseInt(cols[4]) || 0 
                    };
                    
                    if(item.type.includes('prod')) db.prod.push(item);
                    else db.serv.push(item);
                }
            });

            document.getElementById('loader').style.display = 'none';
            render();
        } catch (e) {
            console.error(e);
            document.getElementById('loader').innerText = "‚ö†Ô∏è Error de conexi√≥n con Google Sheets. Verifica que el archivo est√© 'Publicado en la Web'.";
        }
    }

    function switchTab(t) {
        currentTab = t;
        document.getElementById('btn-prod').classList.toggle('active', t === 'prod');
        document.getElementById('btn-serv').classList.toggle('active', t === 'serv');
        render();
    }

    function render() {
        const g = document.getElementById('grid');
        g.innerHTML = '';
        
        if (db[currentTab].length === 0) {
            g.innerHTML = `<p style="text-align:center; grid-column: 1/-1; color: #888;">No hay √≠tems en esta categor√≠a todav√≠a.</p>`;
            return;
        }

        db[currentTab].forEach((item, i) => {
            const out = currentTab === 'prod' && item.s <= 0;
            g.innerHTML += `
                <div class="card">
                    <img src="${item.i}" onerror="this.src='https://via.placeholder.com/300?text=VIPCELL'">
                    <h3>${item.n}</h3>
                    <span class="price">$${item.p.toFixed(2)}</span>
                    <button class="btn-add" onclick="add(${i})" ${out ? 'disabled' : ''}>
                        ${out ? 'AGOTADO' : 'Seleccionar'}
                    </button>
                </div>`;
        });
    }

    function add(i) {
        const item = db[currentTab][i];
        if(!cart[item.n]) cart[item.n] = { ...item, qty: 0 };
        cart[item.n].qty++;
        updateCart();
    }

    function updateCart() {
        const itemsDiv = document.getElementById('cart-items');
        let total = 0; let count = 0;
        itemsDiv.innerHTML = '';
        for (let k in cart) {
            total += cart[k].qty * cart[k].p; count++;
            itemsDiv.innerHTML += `
                <div style="display:flex; justify-content:space-between; margin-bottom:8px; border-bottom: 1px solid #f0f0f0; padding-bottom: 5px;">
                    <span><b>${cart[k].qty}x</b> ${k}</span>
                    <span>$${(cart[k].qty * cart[k].p).toFixed(2)}</span>
                </div>`;
        }
        document.getElementById('cart').style.display = count > 0 ? 'block' : 'none';
        document.getElementById('cart-total').innerText = `$${total.toFixed(2)}`;
    }

    function send() {
        const nom = document.getElementById('c-name').value || "Cliente VIP";
        let msg = `üîê *PEDIDO VIPCELLUNLOCK*\nüë§ *Cliente:* ${nom}\n\n`;
        let total = 0;
        for (let k in cart) {
            total += cart[k].qty * cart[k].p;
            msg += `‚Ä¢ ${cart[k].qty}x ${k} = $${(cart[k].qty * cart[k].p).toFixed(2)}\n`;
        }
        msg += `\nüí∞ *TOTAL A PAGAR: $${total.toFixed(2)}*`;
        window.open(`https://wa.me/${tel}?text=${encodeURIComponent(msg)}`);
        cart = {}; updateCart();
    }

    loadData();
</script>
</body>
</html>